name: Test Extension workflows - Master (3.x) - TEST!!!

on:
  pull_request:
    branches:
      - master

defaults:
  run:
    shell: bash
    working-directory: ./

jobs:
  # test-extensions-creators-and-update-paths:
  #   if: ${{ github.repository_owner == 'rancher' }}
  #   runs-on: ubuntu-latest
  #   outputs:
  #     test-extensions-creators-and-update-paths-job-status: ${{ job.status }}
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4

  #     - name: Retrieve Shell and Creators versions
  #       run: ./.github/workflows/scripts/test-extensions-creators-build.sh
  #       id: test-extensions-and-creators
  #       shell: bash

  branch-checks:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        branch: [master, release-2.9, release-2.8]
    outputs:
      status-master: ${{ job.status }}
      status-release-2.9: ${{ job.status }}
      status-release-2.8: ${{ job.status }}
    steps:
      - name: Checkout ${{ matrix.branch }}
        uses: actions/checkout@v4
        with:
          ref: ${{ matrix.branch }}

      - name: Validate workflows
        shell: bash
        run: .github/workflows/scripts/check-creators-workflows-code.sh "${{ matrix.branch }}"
  
  matching-creators-workflows:
    runs-on: ubuntu-latest
    needs: [branch-checks]
    outputs:
      matching-creators-workflows-job-status: ${{ steps.aggregate.outputs.result }}
    steps:
      - name: Aggregate results
        id: aggregate
        run: |
          # Check all branch check outcomes
          if [[ '${{ needs.branch-checks.result }}' == 'failure' ]]; then
            echo "result=failure" >> $GITHUB_OUTPUT
          else
            echo "result=success" >> $GITHUB_OUTPUT
          fi